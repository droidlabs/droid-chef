# begin: Generated by chef-recipes, please don't edit file directly

*mangle
:PREROUTING ACCEPT [18:1287]
:INPUT ACCEPT [18:1287]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [15:3665]
:POSTROUTING ACCEPT [15:3665]
-A OUTPUT -p tcp -m tcp --dport 80 -j TOS --set-tos 0x10/0x3f
COMMIT
*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [2:205]
:POSTROUTING ACCEPT [2:205]
COMMIT
*filter
:INPUT ACCEPT [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -p icmp -m icmp --icmp-type 11 -j ACCEPT
-A INPUT -p icmp -m icmp --icmp-type 4 -j ACCEPT
-A INPUT -p icmp -m icmp --icmp-type 3 -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
<%- @ports.each do |port, addresses| %>
  <% Array.wrap(addresses).each do |address| %>
    <% if address == 'all' %>
-A INPUT -i eth0 -p tcp -m tcp --dport <%= port %> -j ACCEPT
    <% else %>
-A INPUT -s <%= address %>/32 -i eth0 -p tcp -m tcp --dport <%= port %> -j ACCEPT
    <% end %>
  <% end %>
<% end %>
-A INPUT -i eth0 -m state --state INVALID,NEW -j DROP
-A INPUT -j REJECT --reject-with icmp-port-unreachable
-A FORWARD -i eth0 -m state --state INVALID,NEW -j DROP
-A FORWARD -j REJECT --reject-with icmp-port-unreachable
-A OUTPUT -j ACCEPT
COMMIT

# end: Generated by chef-recipes, please don't edit file directly
